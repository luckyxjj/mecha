<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>banner列表</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link href="assets/css/bootstrap.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="assets/css/font-awesome.min.css"/>
    <link rel="stylesheet" href="assets/css/ace.min.css"/>
    <link rel="stylesheet" href="assets/css/ace-rtl.min.css"/>
    <link rel="stylesheet" href="assets/css/ace-skins.min.css"/>
    <script src="assets/js/ace-extra.min.js"></script>
    <script type="text/javascript" src="assets/profile.js"></script>
    <script src="assets/js/jquery.min.js"></script>
    <script type="text/javascript">window.jQuery || document.write("<script src='assets/js/jquery-2.0.3.min.js'>" + "<" + "/script>");</script>
    <script src="assets/js/bootstrap.min.js"></script>
    <script src="assets/js/bootstrap.js"></script>
    <script src="assets/js/bootstrap-select.min.js"></script>
    <script src="assets/js/bootstrap-table.js"></script>
    <script src="assets/js/bootstrap-table-zh-CN.js"></script>
    <script type="text/javascript" src="assets/js/bootstrap-treeview.js"></script>
    <script src="assets/js/model.js"></script>
    <script type="text/javascript">
        if ("ontouchend" in document) document.write("<script src='assets/js/jquery.mobile.custom.min.js'>" + "<" + "/script>");
    </script>
    <script src="assets/js/bootstrap.min.js"></script>
    <script src="assets/js/typeahead-bs2.min.js"></script>
    <script src="assets/js/jquery.dataTables.min.js"></script>
    <script src="assets/js/jquery.dataTables.bootstrap.js"></script>
    <script src="assets/js/ace-elements.min.js"></script>
    <script src="assets/js/ace.min.js"></script>
    <script type="text/javascript" src="js/jquery.form.js"></script>
    <style>
        .yinchang {
            display: none;
        }
        .img-size{
            color: red;
            float: right;
            width: 45%;
        }
    </style>
</head>
<body>
<div class="page-content">
    <div class="page-header">
        <h1>
            基础管理
            <small>
                <i class="icon-double-angle-right"></i>
                banner列表
            </small>
        </h1>
    </div>
    <div class="row">
        <div class="col-xs-12">
            <h4 class="pink">
                <i class="icon-hand-right icon-animated-hand-pointer blue"></i>
                <a onclick="showAdd()" role="button" class="green">新增</a>
            </h4>

            <div class="row">
                <div class="col-xs-12">
                                <span class="widget-toolbar">
                                    <a onclick="refresh()" href="" data-action="reload">
                                        <i class="icon-refresh"></i>
                                    </a>
                                </span>
                    <div class="table-header">banner列表</div>
                    <div class="table-responsive">
                        <table class="table table-striped table-bordered table-hover"
                               id="table"
                               data-url="bannerBk/getAll"
                               data-method="GET"
                               data-toggle="table"
                               data-toolbar="#toolbar"
                               data-page-size="10"
                               data-page-list="[5,10,15,20]"
                               data-pagination="true"
                               data-side-pagination="server"
                               data-toolbar-align="right"
                               data-query-params="queryParams"
                               data-id-field="id"
                               data-single-select="true" class="width-100">
                            <thead>
                            <tr>
                                <th class="yinchang" data-field="id" class="col-lg-1 col-md-1 col-xs-1">ID</th>
                                <th data-field="name" class="col-lg-1 col-md-1 col-xs-1">名称</th>
                                <th data-field="runUrl" class="col-lg-1 col-md-1 col-xs-1">跳转路径</th>
                                <th data-field="urlCn" data-formatter="formatImg" class="col-lg-1 col-md-1 col-xs-1">中文图片</th>
                                <th data-field="urlEn" data-formatter="formatImg" class="col-lg-1 col-md-1 col-xs-1">英文图片</th>
                                <th data-field="type" data-formatter="fmtBanner" class="col-lg-1 col-md-1 col-xs-1">类型</th>
                                <th data-field="deleteFlag" data-formatter="fmtusing" class="col-lg-1 col-md-1 col-xs-1">状态</th>
                                <th data-field="createTime" class="col-lg-1 col-md-1 col-xs-1">创建时间</th>
                                <th data-formatter="managerOption" class="col-lg-1 col-md-1 col-xs-1">操作</th>
                            </tr>
                            </thead>
                        </table>
                    </div>
                </div>
            </div>

            <div id="modal-table-add" class="modal fade" tabindex="-1">
                <div class="modal-dialog" style="width: 730px">
                    <div class="modal-content">
                        <div class="modal-body no-padding">
                            <div class="row">
                                <div class="col-xs-12 col-sm-12">
                                    <div class="widget-box">
                                        <div class="widget-header">
                                            <h4>新增</h4>
                                        </div>
                                        <div class="widget-body pre-scrollable" style="height:400px">
                                            <div class="widget-main">
                                                <form id="from_regadd" action="#"
                                                      enctype="multipart/form-data" name="from_regadd"
                                                      method="post">
                                                    <div>
                                                        <label>名称</label>
                                                        <input type="text" name="name" placeholder="请输入名称"
                                                               class="form-control limited col-xs-10 col-sm-5">
                                                    </div>
                                                    <div>
                                                        <label>跳转路径</label>
                                                        <input type="text" name="runUrl" placeholder="请输入跳转路径"
                                                               class="form-control limited col-xs-10 col-sm-5">
                                                    </div>
                                                    <div>
                                                        <label>中文图片</label>
                                                        <div>
<!--                                                            <span class="img-size">（建议图片规格为：600*190）</span>-->
                                                            <input id="filephotos" name="file" type="file" value="请选择图片" style="width: 30% !important;"/>
                                                        </div>
                                                        <label>
                                                            <img id="photo" src="" alt="" width="150px" height="100px" style="margin-left: 210px">
                                                        </label>
                                                    </div>
                                                    <div>
                                                        <label>英文图片</label>
                                                        <div>
                                                            <!--                                                            <span class="img-size">（建议图片规格为：600*190）</span>-->
                                                            <input id="filephotos2" name="file" type="file" value="请选择图片" style="width: 30% !important;"/>
                                                        </div>
                                                        <label>
                                                            <img id="photo2" src="" alt="" width="150px" height="100px" style="margin-left: 210px">
                                                        </label>
                                                    </div>
                                                    <div>
                                                        <label>类型</label>
                                                        <select id="type2" name='type' class='form-control'>
                                                            <option value='1'>首页</option>
                                                            <option value='2'>关于我们</option>
                                                            <option value='3'>事业内容架构</option>
                                                            <option value='4'>买机甲</option>
                                                            <option value='5'>卖机甲</option>
                                                            <option value='6'>商城入口</option>
                                                            <option value='7'>创客达人招募</option>
                                                            <option value='8'>服务保障</option>
                                                            <option value='9'>咨询服务</option>
                                                        </select>
                                                    </div>
                                                    <div>
                                                        <label>状态</label>
                                                        <select name="deleteFlag" class="form-control">
                                                            <option value="1">启用</option>
                                                            <option value="0">关闭</option>
                                                        </select>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer no-margin-top">
                        <button class="btn btn-sm btn-danger pull-left" data-dismiss="modal">
                            <i class="icon-remove"></i>关闭
                        </button>
                        <input type="button" value="提交" class="btn icon-ok" onclick="submitAdd()">
                    </div>
                </div>
            </div>

            <div id="modal-table-update" class="modal fade" tabindex="-1">
                <div class="modal-dialog" style="width: 730px">
                    <div class="modal-content">
                        <div class="modal-body no-padding">
                            <div class="row">
                                <div class="col-xs-12 col-sm-12">
                                    <div class="widget-box">
                                        <div class="widget-header">
                                            <h4>修改</h4>
                                        </div>
                                        <div class="widget-body pre-scrollable" style="height:400px">
                                            <div class="widget-main">

                                                <form id="form_edit" action="#" enctype="multipart/form-data"
                                                      name="form_edit" method="post">
                                                    <div>
                                                        <div class='yinchang'><span>ID：</span>
                                                            <input id="id" name="id" readonly="readonly"
                                                                   class="form-control limited col-xs-10 col-sm-5"/>
                                                        </div>
                                                        <div><span>名称：</span>
                                                            <input id="name" name="name"
                                                                   class="form-control limited col-xs-10 col-sm-5"/>
                                                        </div>

                                                        <div><span>跳转路径：</span>
                                                            <input id="runUrl" name="runUrl"
                                                                   class="form-control limited col-xs-10 col-sm-5"/>
                                                        </div>
                                                        <div>
                                                            <span>中文图片：</span>
                                                            <div>
<!--                                                                <span class="img-size">（建议图片规格为：600*190）</span>-->
                                                                <input id="filephotosUpdate" name="file" type="file" value="请选择图片" style="width: 30% !important;"/>
                                                            </div>
                                                            <label>
                                                                <img id="photoUpdate" src="" alt="" width="150px" height="100px" style="margin-left: 210px">
                                                            </label>
                                                        </div>
                                                        <div>
                                                            <span>英文图片：</span>
                                                            <div>
                                                                <!--                                                                <span class="img-size">（建议图片规格为：600*190）</span>-->
                                                                <input id="filephotosUpdate2" name="file" type="file" value="请选择图片" style="width: 30% !important;"/>
                                                            </div>
                                                            <label>
                                                                <img id="photoUpdate2" src="" alt="" width="150px" height="100px" style="margin-left: 210px">
                                                            </label>
                                                        </div>
                                                        <div><span>类型：</span>
                                                            <select id="type" name='type' class='form-control'>
                                                                <option value='1'>首页</option>
                                                                <option value='2'>关于我们</option>
                                                                <option value='3'>事业内容架构</option>
                                                                <option value='4'>买机甲</option>
                                                                <option value='5'>卖机甲</option>
                                                                <option value='6'>商城入口</option>
                                                                <option value='7'>创客达人招募</option>
                                                                <option value='8'>服务保障</option>
                                                                <option value='9'>咨询服务</option>
                                                            </select>
                                                        </div>
                                                        <div><span>状态：</span>
                                                            <select id="isUsing" name='deleteFlag' class='form-control'>
                                                                <option value='0'>关闭</option>
                                                                <option value='1'>启用</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer no-margin-top">
                        <button class="btn btn-sm btn-danger pull-left" data-dismiss="modal">
                            <i class="icon-remove"></i>关闭
                        </button>
                        <input type="button" value="修改" class="btn icon-ok" onclick="submitUpdate()">
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>
<script type="text/javascript">

    function fmtstatus(value) {
        if (value == 1) {
            return "未回复";
        } else if (value == 2) {
            return "已回复";
        }
    }

    function refresh() {
        $("#table").bootstrapTable("refresh");
    }

    function showAdd(){
        $('#modal-table-add').modal('show')
    };

    function showUpdate(t){
        var findRow = $(t).parents("tr")
        var index = $("#table").find(findRow).data("index");
        var list = $("#table").bootstrapTable('getData')[index];
        $('#modal-table-update').modal('show')
        $("#id").val(list.id);
        $("#name").val(list.name);
        $("#runUrl").val(list.runUrl);
        $("#isUsing").val(list.deleteFlag);
        $("#type").val(list.type);
    };

    //新增中文图片选择
    var filephoto = $("#filephotos");
    filephoto.change(function () {
        var files = this.files;
        for (var i = 0; i < files.length; i++) {
            var f = files[i];
            var url = window.URL.createObjectURL(f);
            $('#photo').attr('src', url)
        }
    });
    //新增英文图片选择
    var filephoto2 = $("#filephotos2");
    filephoto2.change(function () {
        var files = this.files;
        for (var i = 0; i < files.length; i++) {
            var f = files[i];
            var url = window.URL.createObjectURL(f);
            $('#photo2').attr('src', url)
        }
    });

    //修改中文图片选择
    var filephotosUpdate = $("#filephotosUpdate");
    filephotosUpdate.change(function () {
        var files = this.files;
        for (var i = 0; i < files.length; i++) {
            var f = files[i];
            var url = window.URL.createObjectURL(f);
            $('#photoUpdate').attr('src', url)
        }
    });

    //修改英文图片选择
    var filephotosUpdate2 = $("#filephotosUpdate2");
    filephotosUpdate2.change(function () {
        var files = this.files;
        for (var i = 0; i < files.length; i++) {
            var f = files[i];
            var url = window.URL.createObjectURL(f);
            $('#photoUpdate2').attr('src', url)
        }
    });
</script>
<script type="text/javascript">
    function managerOption(value, row, index) {
        $(".page-number.active a").attr({
            href: "javascript:void(0)"
        });
        return '<a class="glyphicon glyphicon-edit proEdit" href="javascript:void(0) " onclick="showUpdate(this)" title="修改" />&nbsp;&nbsp;' +
            '<a class="glyphicon glyphicon-trash" href="javascript:void(0)" title="删除" onclick="del(this)" />';
    }
    //新增提交
    function submitAdd() {
        var data = $('#from_regadd').serialize();
        $("#from_regadd").ajaxSubmit({
            type: 'post',
            url: 'bannerBk/add',
            data: data,
            success: function (res) {
                if (res.code == 0) {
                    alert("提交成功");
                    window.location.reload("")
                } else {
                    alert(res.msg);
                }
            },
            error: function (XmlHttpRequest, textStatus, errorThrown) {
                alert("提交失败！")
                alert(res.msg);
            }
        });

    };

    //修改
    function submitUpdate() {
        var data = $('#form_edit').serialize();
        // 同步数据后可以直接取得textarea的value
        $("#form_edit").ajaxSubmit({
            type: 'post',
            url: 'bannerBk/update',
            data: data,
            success: function (res) {
                if (res.code == 0) {
                    alert("修改成功");
                    window.location.reload("")
                } else {
                    alert(res.msg);
                }
            },
            error: function (XmlHttpRequest, textStatus, errorThrown) {
                alert(res.msg);
            }
        });
    }
    //删除
    function del(t) {
        var r = confirm("是否确定删除");
        if (!r) {
            return;
        }
        var delid = $(t).parents("tr").find("td:eq(0)").html()
        $.ajax({
            "type": "POST",
            "data": "id=" + delid,
            "url": "bannerBk/delete",
            "async": false,
            "success": function (res) {
                if (res.code == 0) {
                    alert("删除成功")
                    $("#table").bootstrapTable("refresh");
                } else {
                    alert(res.msg);
                }
            }
        });
    }

    function toNUll(val) {
        if (val == null) {
            return '';
        }
        return val;
    }



    function queryParams(params) {
        var param = $("#condition").serializeArray();
        for (var i in param) {
            params[param[i].name] = param[i].value;
        }
        return params;
    }

    //查询
    $("#searchBtn").click(function () {
        var opt = {
            url: "ContactBK/selectAll",
            silent: true,
            query: queryParams({})
        };
        $("#table").bootstrapTable('refresh', opt);
        $('#table').bootstrapTable('refreshOptions',{pageNumber:1,pageSize:10});
    })

</script>
</body>
</html>