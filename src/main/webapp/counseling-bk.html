<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>咨询服务</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link href="assets/css/bootstrap.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="assets/css/font-awesome.min.css"/>
    <link rel="stylesheet" href="assets/css/ace.min.css"/>
    <link rel="stylesheet" href="assets/css/ace-rtl.min.css"/>
    <link rel="stylesheet" href="assets/css/ace-skins.min.css"/>
    <script src="assets/js/ace-extra.min.js"></script>
    <script type="text/javascript" src="assets/profile.js"></script>
    <script src="assets/js/jquery.min.js"></script>
    <script type="text/javascript">window.jQuery || document.write("<script src='assets/js/jquery-2.0.3.min.js'>" + "<" + "/script>");</script>
    <script src="assets/js/bootstrap.min.js"></script>
    <script src="assets/js/bootstrap.js"></script>
    <script src="assets/js/bootstrap-select.min.js"></script>
    <script src="assets/js/bootstrap-table.js"></script>
    <script src="assets/js/bootstrap-table-zh-CN.js"></script>
    <script type="text/javascript" src="assets/js/bootstrap-treeview.js"></script>
    <script src="assets/js/model.js"></script>
    <script type="text/javascript">
        if ("ontouchend" in document) document.write("<script src='assets/js/jquery.mobile.custom.min.js'>" + "<" + "/script>");
    </script>
    <script src="assets/js/bootstrap.min.js"></script>
    <script src="assets/js/typeahead-bs2.min.js"></script>
    <script src="assets/js/jquery.dataTables.min.js"></script>
    <script src="assets/js/jquery.dataTables.bootstrap.js"></script>
    <script src="assets/js/ace-elements.min.js"></script>
    <script src="assets/js/ace.min.js"></script>
    <script type="text/javascript" src="js/jquery.form.js"></script>
    <script type="text/javascript" src="kindeditor/kindeditor-all.js"></script>
    <script type="text/javascript" src="kindeditor/lang/zh-CN.js"></script>
    <link rel="stylesheet" href="kindeditor/themes/default/default.css"/>
    <style>
        .yinchang {
            display: none;
        }
    </style>
</head>
<body>
<div class="page-content">
    <div class="page-header">
        <h1>
            基础管理
            <small>
                <i class="icon-double-angle-right"></i>
                咨询服务
            </small>
        </h1>
    </div>
    <div class="row">
        <div class="col-xs-12">
            <!--<h4 class="pink">-->
                <!--<i class="icon-hand-right icon-animated-hand-pointer blue"></i>-->
                <!--<a  role="button" class="green" onclick="showModal()">新增</a>-->
            <!--</h4>-->
            <!--<div class="hr hr-18 dotted hr-double"></div>-->
            <div class="row">
                <div class="col-xs-12">
                                <span class="widget-toolbar">
                                    <a onclick="refresh()" href="" data-action="reload">
                                        <i class="icon-refresh"></i>
                                    </a>
                                </span>
                    <div class="table-header">咨询服务列表</div>
                    <div class="table-responsive">
                        <table class="table table-striped table-bordered table-hover"
                               id="table"
                               data-url="counselingBk/getAll"
                               data-method="GET"
                               data-toggle="table"
                               data-toolbar="#toolbar"
                               data-page-size="10"
                               data-page-list="[10,20,50,100]"
                               data-pagination="true"
                               data-side-pagination="server"
                               data-toolbar-align="right"
                               data-query-param="queryParams"
                               data-id-field="id"
                               data-single-select="true" class="width-100">
                            <thead>
                            <tr>
                                <th class="yinchang" data-field="id" class="col-lg-1 col-md-1 col-xs-1">ID</th>
                                <th data-field="..." class="col-lg-6 col-md-6 col-xs-6">内容</th>
                                <th data-field="type" data-formatter="typeFormat" class="col-lg-1 col-md-1 col-xs-1">类型</th>
                                <th data-field="deleteFlag" data-formatter="deleteFormat" class="col-lg-1 col-md-1 col-xs-1">状态</th>
                                <th data-formatter="managerOption" class="col-lg-1 col-md-1 col-xs-1">操作</th>
                            </tr>
                            </thead>
                        </table>
                    </div>
                </div>
            </div>

            <div id="modal-table-update" class="modal fade" tabindex="-1">
                <div class="modal-dialog" style="width: 90%">
                    <div class="modal-content">
                        <div class="modal-body no-padding">
                            <div class="row">
                                <div class="col-xs-12 col-sm-12">
                                    <div class="widget-box">
                                        <div class="widget-header">
                                            <h4>修改</h4>
                                        </div>
                                        <div class="widget-body">
                                            <div class="widget-main">
                                                <form id="form_edit" action="#" enctype="multipart/form-data"
                                                      name="form_edit" method="post">
                                                    <div>
                                                        <div class='yinchang'><span>ID：</span>
                                                            <input id="id" name="id" readonly="readonly"
                                                                   class="form-control limited col-xs-10 col-sm-5"/>
                                                        </div>
                                                        <div><span>语言：</span>
                                                            <select id="type" name='type' class='form-control'>
                                                                <option value="0">中文</option>
                                                                <option value="1">英文</option>
                                                            </select>
                                                        </div>
                                                        <div><span>状态：</span>
                                                            <select id="isUsing" name='deleteFlag' class='form-control'>
                                                                <option value="1">启用</option>
                                                                <option value="0">关闭</option>
                                                            </select>
                                                        </div>
                                                        <br>
                                                        <div><span>内容：</span>
                                                            <textarea id="editor" name="content"
                                                                      style="width:100%;height:300px;"></textarea>
                                                        </div>


                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer no-margin-top">
                        <button class="btn btn-sm btn-danger pull-left" data-dismiss="modal">
                            <i class="icon-remove"></i>关闭
                        </button>
                        <input type="button" value="修改" class="btn icon-ok" onclick="edit()">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">

    //详情编辑器
    $(function () {
        KindEditor.ready(function (K) {
            this.editor = K.create('textarea[id="editor"]', {
                // items: ['source', '|', 'undo', 'redo', '|', 'preview', 'print', 'template', 'code', 'cut', 'copy', 'paste',
                //     'plainpaste', 'wordpaste', '|', 'justifyleft', 'justifycenter', 'justifyright',
                //     'justifyfull', 'insertorderedlist', 'insertunorderedlist', 'indent', 'outdent', 'subscript',
                //     'superscript', 'clearhtml', 'quickformat', 'selectall', '|', 'fullscreen', '/',
                //     'formatblock', 'fontname', 'fontsize', '|', 'forecolor', 'hilitecolor', 'bold',
                //     'italic', 'underline', 'strikethrough', 'lineheight', 'removeformat', '|', 'multiimage',
                //     'table', 'hr', 'emoticons', 'baidumap', 'pagebreak',
                //     'anchor', 'link', 'unlink'],
                uploadJson: 'kindeditor/jsp/upload_json.jsp',
                fileManagerJson: 'kindeditor/jsp/file_manager_json.jsp',
                allowFileManager: true,
                formatUploadUrl: false,
                allowImageUpload: true,

                afterUpload: function () {
                    this.sync();
                }, //图片上传后，将上传内容同步到textarea中

                afterBlur: function () {
                    this.sync();
                },   ////失去焦点时，将上传内容同步到textarea中
            });
        });
    });
    function showUpdate(t){
        //$(t).parents("tr").addClass("danger")
        var findRow = $(t).parents("tr")
        var index = $("#table").find(findRow).data("index");
        var list = $("#table").bootstrapTable('getData')[index];
        $('#modal-table-update').modal('show')
        $("#id").val(list.id);
        editor.html(list.content);//取得HTML内容
        $("#type").val(list.type);
        $("#isUsing").val(list.deleteFlag);
    };
    // //选中行改变颜色
    // $("#table").on("click-row.bs.table",function(e,row,ele){
    //     $(".danger").removeClass("danger");
    //     $(ele).addClass("danger");
    // });


    function refresh() {
        $("#table").bootstrapTable("refresh");
    }
    function managerOption(value, row, index) {
        $(".page-number.active a").attr({
            href: "javascript:void(0)"
        });
        return '<a class="glyphicon glyphicon-edit proEdit" role="button"  onclick="showUpdate(this)" title="修改" />';
    }

    function typeFormat(value, row, index) {
        if (value==0) {
            return "中文"
        }else {
            return "英文"
        }
    }

    function deleteFormat(value) {
        if (value==0) {
            return "关闭"
        }else {
            return "启用"
        }
    }

    //修改商品
    function edit() {
        var data = $('#form_edit').serialize();
        // 同步数据后可以直接取得textarea的value
        editor.sync();
        // 设置HTML内容
        editor.html(data.dirValue);
        $("#form_edit").ajaxSubmit({
            type: 'post',
            url: 'counselingBk/update',
            data: data,
            success: function (res) {
                if (res.code == 0) {
                    alert("修改成功");
                    window.location.reload("")
                } else {
                    alert(res.msg);
                }
            },
            error: function (XmlHttpRequest, textStatus, errorThrown) {
                alert(res.msg);
            }
        });
    }


    function queryParams(param) {
        var param = $("#condition").serializeArray();
        for (var i in param) {
            param[param[i].name] = param[i].value;
        }
        return param
    }

</script>
</body>
</html>